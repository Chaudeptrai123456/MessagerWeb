server:
  port: 8090
spring:
  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: http://localhost:9999/oauth2/jwks
      client:
        registration:
          messenger:
            client-id: chau
            client-secret: 123   # ⚠️ Chỉ dùng dev, prod phải bảo mật
            scope: openid, profile, email
            authorization-grant-type: authorization_code
            redirect-uri: "{baseUrl}/login/oauth2/code/messenger"
        provider:
          messenger:
            issuer-uri: http://localhost:9999
  cloud:
    gateway:
      default-filters:
        - TokenRelay
      server:
        webflux:
          routes:
            # ✅ OAuth2 callback (Spring xử lý, không cần TokenRelay)
            - id: oauth2-callback
              uri: http://localhost:8090
              predicates:
                - Path=/login/oauth2/code/messenger
            # ✅ Product Service route
            - id: product-service
              uri: http://localhost:8081
              predicates:
                - Path=/api/service/**
            # ✅ Fallback route
            - id: central-server
              uri: http://localhost:9999
              predicates:
                - Path=/api/**
logging:
  level:
    org.springframework.security: DEBUG  # Giúp debug OAuth2 flow
---
spring.config.activate.on-profile: docker
spring:
  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: http://backend:9999/oauth2/jwks
  cloud:
    gateway:
      server:
        webflux:
          routes:
            - id: product-service
              uri: http://node-server:8081
              predicates:
                - Path=/api/service/**
            - id: forward-write-to-central
              uri: http://backend:9999
              predicates:
                - Path=/api/**
            - id: login
              uri: http://backend:9999
              predicates:
                - Path=/login/**
logging:
  level:
    org.springframework.security: DEBUG
